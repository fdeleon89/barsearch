<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Phone Directory Search</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            padding: 40px;
            backdrop-filter: blur(10px);
            animation: slideIn 0.5s ease-out;
        }
        
        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
            font-size: 2.5em;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .search-container {
            position: relative;
            margin-bottom: 30px;
        }
        
        .search-wrapper {
            position: relative;
            display: flex;
            gap: 10px;
        }
        
        #searchInput {
            flex: 1;
            padding: 15px 20px;
            font-size: 16px;
            border: 2px solid #e0e0e0;
            border-radius: 50px;
            outline: none;
            transition: all 0.3s ease;
            background: white;
        }
        
        #searchInput:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }
        
        .search-btn {
            padding: 15px 30px;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            border-radius: 50px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        
        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(102, 126, 234, 0.5);
        }
        
        .search-btn:active {
            transform: translateY(0);
        }
        
        .file-upload-container {
            margin-bottom: 20px;
            text-align: center;
        }
        
        .file-input-wrapper {
            position: relative;
            display: inline-block;
        }
        
        #fileInput {
            display: none;
        }
        
        .file-label {
            display: inline-block;
            padding: 12px 25px;
            background: linear-gradient(135deg, #56ab2f, #a8e063);
            color: white;
            border-radius: 50px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(86, 171, 47, 0.3);
        }
        
        .file-label:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(86, 171, 47, 0.4);
        }
        
        .file-status {
            margin-top: 10px;
            color: #666;
            font-size: 14px;
        }
        
        #results {
            animation: fadeIn 0.5s ease-out;
        }
        
        @keyframes fadeIn {
            from {
                opacity: 0;
            }
            to {
                opacity: 1;
            }
        }
        
        .result-item {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 5px 20px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
            border-left: 5px solid #667eea;
        }
        
        .result-item:hover {
            transform: translateX(5px);
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.15);
        }
        
        .branch-header {
            margin-bottom: 20px;
            padding-bottom: 15px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .branch-code {
            display: inline-block;
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 14px;
            font-weight: 600;
            margin-bottom: 10px;
        }
        
        .branch-name {
            font-size: 24px;
            color: #333;
            font-weight: 600;
            margin-top: 5px;
        }

        .branch-manager {
            font-size: 18px;
            color: #555;
            font-weight: 500;
            margin-top: 5px;
        }
        
        .phone-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .phone-item {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }
        
        .phone-item:hover {
            background: #e9ecef;
            transform: scale(1.02);
        }
        
        .phone-label {
            font-size: 12px;
            color: #666;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 5px;
            font-weight: 600;
        }
        
        .phone-number {
            font-size: 18px;
            color: #333;
            font-weight: 500;
        }
        
        .phone-number.empty {
            color: #999;
            font-style: italic;
        }
        
        .no-results {
            text-align: center;
            padding: 40px;
            color: #666;
            font-size: 18px;
        }
        
        .error-message {
            background: #fee;
            color: #c33;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #c33;
        }
        
        .info-message {
            background: #e7f3ff;
            color: #0066cc;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            border-left: 5px solid #0066cc;
        }
        
        .loading {
            text-align: center;
            padding: 20px;
            color: #666;
        }
        
        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>📞 Phone Directory Search</h1>
        
        <div class="file-upload-container">
            <div class="file-input-wrapper">
                <input type="file" id="fileInput" accept=".csv,.xlsx,.xls">
                <label for="fileInput" class="file-label">📁 Load Data File (CSV/Excel)</label>
            </div>
            <div class="file-status" id="fileStatus">No file loaded - Please select dataphonece.xlsx or dataphonece.csv</div>
        </div>
        
        <div class="search-container">
            <div class="search-wrapper">
                <input type="text" id="searchInput" placeholder="Search by Branch Code or Branch Name..." disabled>
                <button class="search-btn" onclick="searchData()" id="searchBtn" disabled>Search</button>
            </div>
        </div>
        
        <div id="results"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.0/papaparse.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    
    <script>
        let config = {};
        let phoneData = [];
        let isDataLoaded = false;

        


        // // Cargar el archivo JSON de configuración
        fetch('phone-directory-config.json')
            .then(response => {
                 if (!response.ok) {
                     throw new Error('No se pudo cargar el archivo JSON');
                 }
                 return response.json();
             })
             .then(data => {
                 config = data;
                 console.log('Config cargado:', config); // <-- Depuración
                 document.title = config.title || document.title;
                 document.querySelector('h1').textContent = `📞 ${config.title}`;
                 searchInput.placeholder = `Buscar por ${config.search.input}...`;
                 if (config.autoLoadFilePath) {
                     autoLoadFile(config.autoLoadFilePath);
                 }
             })
             .catch(error => {
                 console.error('Error cargando configuración:', error);
                document.querySelector('h1').textContent = '📞 Phone Directory Search (config error)';
             });

        // Función para cargar el archivo automáticamente
        function autoLoadFile(filePath) {
            // Detecta el tipo de archivo por la extensión
            if (filePath.endsWith('.csv')) {
                fetch(filePath)
                    .then(response => response.text())
                    .then(csvText => {
                        Papa.parse(csvText, {
                            header: true,
                            dynamicTyping: true,
                            skipEmptyLines: true,
                            complete: function(results) {
                                phoneData = results.data;
                                onDataLoaded(filePath);
                            },
                            error: function(error) {
                                showError('Error parsing CSV file: ' + error.message);
                            }
                        });
                    })
                    .catch(() => {
                        document.getElementById('fileStatus').innerHTML = 
                            'No file loaded - Please select datasourse'
                    });
            } else if (filePath.endsWith('.xlsx') || filePath.endsWith('.xls')) {
                fetch(filePath)
                    .then(response => response.arrayBuffer())
                    .then(arrayBuffer => {
                        const data = new Uint8Array(arrayBuffer);
                        const workbook = XLSX.read(data, { type: 'array' });
                        const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                        phoneData = XLSX.utils.sheet_to_json(firstSheet);
                        onDataLoaded(filePath);
                    })
                    .catch(() => {
                        document.getElementById('fileStatus').innerHTML = 
                            'No file loaded - Please select datasourse';
                    });
            }
        }

        // File input change handler
        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const fileName = file.name.toLowerCase();
                if (fileName.endsWith('.csv')) {
                    loadCSVFile(file);
                } else if (fileName.endsWith('.xlsx') || fileName.endsWith('.xls')) {
                    loadExcelFile(file);
                } else {
                    showError('Please select a CSV or Excel file');
                }
            }
        });

        // Load CSV file
        function loadCSVFile(file) {
            showLoading();
            Papa.parse(file, {
                header: true,
                dynamicTyping: true,
                skipEmptyLines: true,
                complete: function(results) {
                    phoneData = results.data;
                    onDataLoaded(file.name);
                },
                error: function(error) {
                    showError('Error parsing CSV file: ' + error.message);
                }
            });
        }

        // Load Excel file
        function loadExcelFile(file) {
            showLoading();
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const data = new Uint8Array(e.target.result);
                    const workbook = XLSX.read(data, { type: 'array' });
                    const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                    phoneData = XLSX.utils.sheet_to_json(firstSheet);
                    onDataLoaded(file.name);
                } catch (error) {
                    showError('Error reading Excel file: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(file);
        }

        // Called when data is successfully loaded
        function onDataLoaded(fileName) {
            isDataLoaded = true;
            document.getElementById('searchInput').disabled = false;
            document.getElementById('searchBtn').disabled = false;
            document.getElementById('fileStatus').innerHTML = 
                `✅ File loaded: <strong>${fileName}</strong> (${phoneData.length} records)`;
            document.getElementById('fileStatus').style.color = '#28a745';
            document.getElementById('results').innerHTML = 
                '<div class="info-message">Data loaded successfully! You can now search for branches.</div>';
            
            // Focus on search input
            document.getElementById('searchInput').focus();
        }

        // Show loading spinner
        function showLoading() {
            document.getElementById('results').innerHTML = 
                '<div class="loading"><div class="spinner"></div>Loading data...</div>';
        }

        // Show error message
        function showError(message) {
            document.getElementById('results').innerHTML = 
                `<div class="error-message">${message}</div>`;
            document.getElementById('fileStatus').innerHTML = 'Error loading file';
            document.getElementById('fileStatus').style.color = '#dc3545';
        }

        // Search function
        function searchData() {
            if (!isDataLoaded) {
                showError('Please load a data file first');
                return;
            }

            const searchTerm = document.getElementById('searchInput').value.trim().toLowerCase();
            
            if (!searchTerm) {
                document.getElementById('results').innerHTML = 
                    '<div class="info-message">Please enter a Branch Code or Branch Name to search</div>';
                return;
            }

            const results = phoneData.filter(row => {
                const branchCode = (row['BranchCode'] || '').toString().toLowerCase();
                const branchName = (row['Branch Name'] || '').toString().toLowerCase();
                return branchCode.includes(searchTerm) || branchName.includes(searchTerm);
            });

            displayResults(results);
        }

        // Display search results
        function displayResults(results) {
            const resultsDiv = document.getElementById('results');
            
            if (results.length === 0) {
                resultsDiv.innerHTML = 
                    '<div class="no-results">No branches found matching your search criteria</div>';
                return;
            }

            let html = '';
            results.forEach(branch => {
                html += `
                    <div class="result-item">
                        <div class="branch-header">
                            <span class="branch-code">${branch['BranchCode'] || 'N/A'}</span>
                            <div class="branch-name">${branch['Branch Name'] || 'Unknown Branch'}</div>
                            <div class="branch-manager">Gerente: ${branch['Manager'] || 'Unknown Branch'}</div>
                        </div>
                        <div class="phone-grid">
                            ${createPhoneItem('Extension 1', branch['Extensions'])}
                            ${createPhoneItem('Extension 2', branch['Ext 2'])}
                            ${createPhoneItem('Extension 3', branch['Ext 3'])}
                            ${createPhoneItem('Flota Gerencia', branch['Flota Gerencia'])}
                            ${createPhoneItem('Flota 1', branch['Flota 1'])}
                            ${createPhoneItem('Flota 2', branch['Flota 2'])}
                            ${createPhoneItem('Direct Line 1', branch['Directo 1'])}
                            ${createPhoneItem('Direct Line 2', branch['Directo 2'])}
                        </div>
                    </div>
                `;
            });
            
            resultsDiv.innerHTML = html;
        }

        // Create individual phone item HTML
        function createPhoneItem(label, number) {
            const hasNumber = number && number !== '' && number !== 'N/A';
            return `
                <div class="phone-item">
                    <div class="phone-label">${label}</div>
                    <div class="phone-number ${hasNumber ? '' : 'empty'}">
                        ${hasNumber ? formatPhoneNumber(number) : 'Not available'}
                    </div>
                </div>
            `;
        }

        // Format phone number for better display
        function formatPhoneNumber(number) {
            // Convert to string and remove any non-numeric characters for formatting
            const cleaned = number.toString().replace(/\D/g, '');
            
            // If it's a standard length number, format it nicely
            if (cleaned.length === 10) {
                return cleaned.replace(/(\d{3})(\d{3})(\d{4})/, '($1) $2-$3');
            } else if (cleaned.length === 7) {
                return cleaned.replace(/(\d{3})(\d{4})/, '$1-$2');
            }
            
            // Otherwise return as-is
            return number.toString();
        }

        // Enable Enter key for search
        document.getElementById('searchInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter' && isDataLoaded) {
                searchData();
            }
        });
    </script>
</body>
</html>
